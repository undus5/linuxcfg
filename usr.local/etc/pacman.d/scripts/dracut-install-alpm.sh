#!/usr/bin/env bash

# If KERNEL_INSTALL_INITRD_GENERATOR is set, disable this hook
if [ -n "$KERNEL_INSTALL_INITRD_GENERATOR" ]; then
    exit 0
fi

args=('--force' '-L 3')

while read -r line; do
    if [[ "$line" == 'usr/lib/modules/'+([^/])'/pkgbase' ]]; then
        read -r pkgbase < "/${line}"
        kver="${line#'usr/lib/modules/'}"
        kver="${kver%'/pkgbase'}"

        echo "--> Building initramfs for ${pkgbase} (${kver})"
        /usr/local/sbin/dracut-install.sh "${kver}"
    fi
done
